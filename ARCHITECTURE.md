# System Architecture

## Overview
This project is a daily expense tracking system designed for speed, modularity, and AI integration. It leverages **Supabase** for Backend-as-a-Service (DB & Auth) and **Streamlit** for the frontend UI, with **OpenAI** handling natural language processing.

## Components

### 1. User Interface (Frontend)
- **Component**: Streamlit App (`app.py`, `modules/ui_v2.py`)
- **Role**: Command Center & Visualization
- **Features**:
    - **Smart Chat**: Integrated GPT-4o for natural language recording and querying.
    - **Dashboard**: Real-time KPI cards, interactive charts, and data editors.
    - **Management**: Dedicated pages for Budgets and Subscriptions.
    - **Mobile**: Responsive layout with touch-friendly elements and floating navigation.

### 2. Business Logic Layer
- **Component**: Python Modules (`modules/services.py`, `modules/auth.py`)
- **Role**: Abstraction Layer
- **Responsibility**:
    - Handling Supabase connections and queries.
    - Data processing, cleaning, and aggregation (Pandas).
    - Session management and authentication flow.

### 3. Data Storage & Auth
- **Component**: Supabase
- **Database**: PostgreSQL (Tables: `expenses`, `budgets`, `recurring_rules`)
- **Auth**: Supabase Auth (Email/Password) with improved Session persistence. Uses `user_metadata` to permanently store individual preferences like `currency_symbol` and `openai_api_key`.

### 4. External Services
- **OpenAI**: NLP (Text parsing & Intent recognition).

## Data Flow (V3.4)
1. **Chat Recording**: `UI` (Input) -> `expense_chat.py` (NLP) -> `services.py` (Insert) -> `Supabase`.
2. **Dashboard**: `UI` (Load) -> `services.py` (Query) -> `Supabase` -> `Pandas DataFrame` -> `UI`.
3. **Budget/Subs**: `UI` (Edit) -> `services.py` (Update/Delete) -> `Supabase`.

## File Structure Strategy
The project is refactored into a modular design:
- **`modules/`**: Contains all reusable logic and UI components.
    - `auth.py`: Handles login/signup/session.
    - `services.py`: Handles all database interactions.
    - `ui_v2.py`: Handles all rendering and frontend styling.
- **`app.py`**: Minimalist entry point, acting as a router.
- **`assets/`**: Static assets (logos, icons).
- **`scripts/`**: Cron job scripts for automated tasks.

## Future Roadmap
1. **Multi-User Scalability**: Enhanced RLS policies in Supabase.
4. **Mobile Optimization** (V3.4):
    - **Single-Page Flow**: Vertical scrolling dashboard for natural mobile usage.
    - **DOM Injection**: Custom JavaScript to inject floating navigation bars outside the Streamlit iframe sandbox.
    - **CSS Overrides**: Targeted `@media` queries or Python-based device detection to inject compact CSS.
3. **Advanced Analytics**: Year-over-Year reports generated by AI.
