# GTPinput ğŸ’°
**GPT æ™ºèƒ½è®°è´¦ç³»ç»Ÿ V3.4**

è¿™æ˜¯ä¸€ä¸ªç”± GPT é©±åŠ¨çš„ä¸ªäººè®°è´¦å…¨æ ˆç³»ç»Ÿï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€è®°è´¦ã€è‡ªåŠ¨åˆ†ç±»ã€å®æ—¶æ±‡æ€»ã€è‡ªåŠ¨å‘¨æœŸæ‰£æ¬¾ã€æœˆåº¦é¢„ç®—ç®¡ç†ï¼Œå¹¶é€šè¿‡ Streamlit æä¾›æ‰‹æœº/ç”µè„‘å‹å¥½çš„å¯è§†åŒ– Dashboardã€‚

**æœ€æ–°æ¶æ„ (v3.0)**ï¼š
- **è®°è´¦**: Streamlit Chat UI (è¾“å…¥) â†’ OpenAI (è§£æ) â†’ Cloudflare Worker (API) â†’ D1 Database
- **æ–‡æ¡£**: Streamlit File Uploader â†’ OpenAI (è¯†å›¾) â†’ Google Drive/Sheets/Calendar (å½’æ¡£)

---

## âœ¨ V3.0 æ–°ç‰¹æ€§

### 1. ğŸ“… æœˆåº¦é¢„ç®—ç®¡ç† (Monthly Budgets)
- **è‡ªåŠ¨è½®è½¬**ï¼šé¢„ç®—è¿›åº¦æŒ‰æœˆè‡ªåŠ¨é‡ç½®ã€‚
- **å¯è§†åŒ–è¿›åº¦æ¡**ï¼šè‡ªå®šä¹‰ CSS å®ç°çš„é«˜é¢œå€¼è¿›åº¦æ¡ï¼Œæ”¯æŒæ˜äº®/æš—é»‘åŒæ¨¡å¼ã€‚
- **å›¾æ ‡é˜µåˆ—**ï¼š10x4 äº¤äº’å¼ Emoji é€‰æ‹©é¢æ¿ï¼Œè®©æ¯ä¸ªåˆ†ç±»éƒ½ä¸ªæ€§åè¶³ã€‚

### 2. ğŸ”„ è‡ªåŠ¨å‘¨æœŸæ‰£æ¬¾ (Recurring Expenses)
- **å›ºå®šå¼€é”€è‡ªåŠ¨åŒ–**ï¼šæ”¯æŒâ€œæˆ¿ç§Ÿâ€ã€â€œè®¢é˜…è´¹â€ç­‰å›ºå®šæ”¯å‡ºçš„è‡ªåŠ¨è®°å½•ã€‚
- **Cron è§¦å‘**ï¼šåŸºäº Cloudflare Cron Triggersï¼Œæ¯å¤©è‡ªåŠ¨æ£€æŸ¥å¹¶ç”Ÿæˆè´¦å•ã€‚
- **çµæ´»é…ç½®**ï¼šæ”¯æŒæŒ‰å‘¨ã€æŒ‰æœˆã€æŒ‰å¹´è®¾ç½®è§„åˆ™ï¼ˆå¦‚â€œæ¯æœˆ 1 æ—¥â€ã€â€œæ¯å‘¨äº”â€ï¼‰ã€‚

### 3. ğŸ¤– GPT èƒ½åŠ›å‡çº§ (Custom GPT Actions)
- **ä¸ä»…æ˜¯è®°å½•**ï¼šç°åœ¨èµ‹äºˆäº† GPT **åˆ é™¤**å’Œ**ä¿®æ”¹**è®°å½•çš„æƒé™ã€‚
- **è‡ªç„¶è¯­è¨€æ“ä½œ**ï¼š
    - "æŠŠæ˜¨å¤©é‚£ç¬”æ‰“è½¦è´¹åˆ äº†"
    - "æˆ¿ç§Ÿé‡‘é¢æ”¹æˆ 2600"
    - "æŸ¥ä¸€ä¸‹ä¸Šå‘¨åƒé¥­èŠ±äº†å¤šå°‘"

### 4. âœ… æ™ºèƒ½äº¤äº’åŠ©æ‰‹ (New)
- **è®°è´¦**: "åˆé¥­ 30"
- **æŸ¥è¯¢**: "ä¸Šä¸ªæœˆèŠ±äº†å¤šå°‘ï¼Ÿ", "æŸ¥ä¸€ä¸‹ä¹°æ°´æœçš„è®°å½•"
- **åˆ é™¤**: "åˆ é™¤ä¸Šä¸€æ¡", "åˆ é™¤ä¹°çƒŸçš„è®°å½•"

### 5. âœ… æ™ºèƒ½æ–‡æ¡£å½’æ¡£ (New)
- **é›†æˆ SmartDoc æ ¸å¿ƒå¼•æ“**ï¼šä¸Šä¼ å‘ç¥¨/è¯ä»¶ç…§ç‰‡ï¼Œè‡ªåŠ¨è¯†åˆ«å¹¶ä¸Šä¼ è‡³ Google Driveï¼Œå†™å…¥ Google Sheets å’Œ Calendarã€‚

### 6. âœ… æ”¶æ®è‡ªåŠ¨è®°è´¦ (New)
- **è‡ªåŠ¨æå–**ï¼šä¸Šä¼ æ”¶æ®å›¾ç‰‡æ—¶ï¼Œè‡ªåŠ¨æå–é‡‘é¢å¹¶è®°å…¥è´¦æœ¬ã€‚

### 7. âœ… æ ¸å¿ƒç³»ç»Ÿå‡çº§
- **API é©±åŠ¨**ï¼šä½¿ç”¨ Cloudflare Worker + D1ï¼Œå“åº”é€Ÿåº¦æå¿«ã€‚
- **å…¨åŠŸèƒ½ä»ªè¡¨ç›˜**ï¼š
    - **KPI æ¦‚è§ˆ**ï¼šæœ¬æœˆ/ä»Šå¹´æ”¯å‡ºã€ç­›é€‰åˆè®¡ã€è®°å½•ç¬”æ•°ã€‚
    - **å¯è§†åŒ–å›¾è¡¨**ï¼šæœˆåº¦è¶‹åŠ¿æŸ±çŠ¶å›¾ã€åˆ†ç±»å æ¯”é¥¼å›¾ã€‚
    - **äº¤äº’å¼è¡¨æ ¼**ï¼šæ”¯æŒæŒ‰æœˆ/åˆ†ç±»ç­›é€‰ã€‚
- **ğŸ“¸ ç§»åŠ¨ç«¯ç›¸æœºæ”¯æŒ (New)**ï¼š
    - é›†æˆç½‘é¡µç‰ˆç›¸æœºï¼Œæ”¯æŒæ‰‹æœºç«¯ç›´æ¥æ‹ç…§ä¸Šä¼ ã€‚
    - è‡ªåŠ¨åˆ¤æ–­æ–‡ä»¶æ¥æºï¼ˆç›¸å†Œ/ç›¸æœºï¼‰è¿›è¡Œæ™ºèƒ½åˆ†ç±»ã€‚
- **ğŸ¨ ä¸“ä¸šçº§ UI è®¾è®¡ (New)**ï¼š
    - **Deep Blue Theme**ï¼šæ·±è“æå®¢é£æ ¼ç•Œé¢ï¼ŒæŠ¤çœ¼ä¸”ä¸“ä¸šã€‚
    - **æ™ºèƒ½äº¤äº’è®¾è®¡**ï¼šå·¦ä¾§å¯¹é½çš„æ²‰æµ¸å¼å¯¹è¯ä½“éªŒã€‚
    - **åŠ¨æ€å¤´åƒ**ï¼šé›†æˆ Dicebear é«˜æ¸…çŸ¢é‡å¤´åƒ (æœºå™¨äºº ğŸ¤– vs ç”¨æˆ· ğŸ§‘)ã€‚
- **æ•°æ®ç®¡ç†èƒ½åŠ›**ï¼š
    - **ç¼–è¾‘**ï¼šç›´æ¥åœ¨è¡¨æ ¼ä¸­ä¿®æ”¹é‡‘é¢ã€åˆ†ç±»ã€æ—¥æœŸç­‰ã€‚
    - **åˆ é™¤**ï¼šæ”¯æŒå‹¾é€‰å¤šæ¡è®°å½•ä¸€é”®åˆ é™¤ã€‚
    - **æ¸…ç©º**ï¼šæä¾›â€œDanger Zoneâ€ä¸€é”®æ¸…ç©ºæ‰€æœ‰æ•°æ®åŠŸèƒ½ã€‚

### 8. ğŸš€ V3.1 ä½“éªŒå‡çº§ (Updates)
- **ğŸ” ä¿æŒç™»å½• (Persistent Login)**: æ”¯æŒ "Remember Me" é€‰é¡¹ï¼Œè‡ªåŠ¨ç¼“å­˜ä¼šè¯ï¼Œå…å»é‡å¤ç™»å½•çƒ¦æ¼ã€‚
- **ğŸ”„ æ‰‹åŠ¨åˆ·æ–° (Manual Refresh)**: ä»ªè¡¨ç›˜æ–°å¢åˆ·æ–°æŒ‰é’®ï¼Œä¸€é”®åŒæ­¥æœ€æ–°æ•°æ®ã€‚
- **âœ¨ äº¤äº’ä¼˜åŒ–**:
    - å…¨æ–° "Thinking..." æ€è€ƒåŠ¨ç”» (å…‰ç¯ç‰¹æ•ˆ)ã€‚
    - ç™»å½•ç•Œé¢æ”¯æŒå›è½¦é”®æäº¤ã€‚
    - è®°å½•åˆ—è¡¨æŒ‰ "æ—¥æœŸ + å½•å…¥é¡ºåº" æ™ºèƒ½æ’åºã€‚

    - è®°å½•åˆ—è¡¨æŒ‰ "æ—¥æœŸ + å½•å…¥é¡ºåº" æ™ºèƒ½æ’åºã€‚

### 9. ğŸ“ æ™ºèƒ½å¤‡æ³¨ç³»ç»Ÿ (New)
ç³»ç»Ÿé€šè¿‡ä¸“å±å›¾æ ‡è‡ªåŠ¨æ ‡è¯†è®°å½•æ¥æºï¼Œä¸€ç›®äº†ç„¶ï¼š
- ğŸ’¬ **App åŠ©æ‰‹**ï¼šç½‘é¡µ/æ‰‹æœºç«¯ç›´æ¥å¯¹è¯å½•å…¥ï¼ˆå¦‚ `ğŸ’¬ åˆé¥­ 20`ï¼‰ã€‚
- ğŸ¤– **å®šåˆ¶ GPT**ï¼šé€šè¿‡å¤–éƒ¨ GPTs / API è°ƒç”¨å½•å…¥ï¼ˆå¦‚ `ğŸ¤– å¤–éƒ¨GPTè®°å½•`ï¼‰ã€‚
- ğŸ”„ **è‡ªåŠ¨è®¢é˜…**ï¼šç³»ç»Ÿè‡ªåŠ¨æ‰£æ¬¾ç”Ÿæˆçš„è®°å½•ï¼ˆå¦‚ `ğŸ”„ è‡ªåŠ¨è®¢é˜…`ï¼‰ã€‚

### 10. ğŸš€ V3.2 æœ€æ–°æ›´æ–° (Latest)
- **ğŸ“± å“åº”å¼å¸ƒå±€ (Responsive Layout)**: é¡µé¢ç°åœ¨è‡ªåŠ¨é€‚åº”å®½å±æ˜¾ç¤ºå™¨å’Œæ‰‹æœºå±å¹•ï¼Œè§†è§‰ä½“éªŒæ›´ä½³ã€‚
- **ğŸ”„ å¢å¼ºçš„è®¢é˜…ç®¡ç†**:
    - æ–°å¢ **Weekly (æ¯å‘¨)** æ‰£æ¬¾å‘¨æœŸæ”¯æŒã€‚
    - æ›´åŠ ç›´è§‚çš„æ—¥æœŸé€‰æ‹©å™¨ (Calendar Date Picker)ã€‚
    - æ™ºèƒ½æ˜¾ç¤ºä¸‹æ¬¡æ‰£æ¬¾è§„åˆ™ (å¦‚ "æ¯å‘¨äº”" æˆ– "æ¯æœˆ25æ—¥")ã€‚
- **ğŸ—‘ï¸ ä¾¿æ·åˆ é™¤åŠŸèƒ½**:
    - åœ¨â€œé¢„ç®—ç®¡ç†â€å’Œâ€œè®¢é˜…ç®¡ç†â€ä¸­æ–°å¢äº†ç‹¬ç«‹çš„ **åˆ é™¤ (Delete)** å‹¾é€‰æ¡†ã€‚
    - å‹¾é€‰åä¿å­˜å³å¯åˆ é™¤ï¼Œæ“ä½œæ›´å®‰å…¨ã€ç›´è§‚ã€‚

### 10. ğŸš€ V3.3 è§†è§‰é‡æ„ (Visual Overhaul)
- **ğŸ’³ é¢„ç®—å¡ç‰‡é‡æ„ (Budget Cards Redesign)**:
    - **åŒè‰²å¡ç‰‡è®¾è®¡**: é¡¶éƒ¨èŒä¸šæ·±è“ (Professional Dark Blue) + åº•éƒ¨æš—é»‘æ—¶é—´è½´ã€‚
    - **æ™ºèƒ½è¿›åº¦æ¡**: 
        - ç²—å£®è¿›åº¦æ¡ (40px) é…åˆåœ†è§’è®¾è®¡ã€‚
        - **é¢œè‰²åŠ¨æ€é¢„è­¦**: ğŸ”µå¥åº· / ğŸŸ é¢„è­¦ / ğŸ”´è¶…æ”¯ã€‚
        - **Today æŒ‡é’ˆ**: å®æ—¶æ˜¾ç¤ºå½“å‰æ—¥æœŸåœ¨æœˆåº¦æ—¶é—´è½´ä¸Šçš„ä½ç½®ã€‚
    - **æ¯æ—¥å»ºè®®**: è‡ªåŠ¨è®¡ç®—å‰©ä½™å¤©æ•°çš„å»ºè®®æ—¥å‡æ¶ˆè´¹é¢ã€‚
- **ğŸ“Š è§†è§‰ä¸€è‡´æ€§**:
    - å…¨å±€ç»Ÿä¸€çš„ KPI æ ‡é¢˜æ ·å¼ (Bold + Icon)ã€‚
    - çƒ­åŠ›å›¾ (Heatmap) é«˜åº¦ä¸¥æ ¼å¯¹é½ï¼Œè§†è§‰æ›´æ•´æ´ã€‚

### 11. ğŸ¨ V3.5 æè‡´ UI ä¸ ç¨³å®šæ€§ (Professional Refinement)
- **ç»¼åˆå¡ç‰‡ V3 (Unified KPI Card)**:
    *   **Hero è§†å›¾**: é‡‡ç”¨è¶…å¤§åŠ ç²—å­—ä½“ä¸æ–‡å­—æ¸å˜æ•ˆæœï¼Œè§†è§‰é‡å¿ƒæ›´æ˜ç¡®ã€‚
    *   **æ¯›ç»ç’ƒè®¾è®¡**: åŠé€æ˜å¡ç‰‡å åŠ  (`backdrop-filter`)ï¼Œæå‡äº†ç•Œé¢çš„ç°ä»£æ„Ÿä¸å±‚æ¬¡æ„Ÿã€‚
    *   **é‡‘èçº§æ’ç‰ˆ**: ä¼˜åŒ–äº†æ ‡ç­¾å­—ä½“é—´è·ä¸å›¾æ ‡æ¯”ä¾‹ï¼Œæ¨¡æ‹Ÿä¸“ä¸šé‡‘è App çš„ç»†è…»è´¨æ„Ÿã€‚
- **æ¸²æŸ“å¼•æ“ä¿®å¤**:
    *   **é›¶ç¼©è¿›ç­–ç•¥**: å½»åº•è§£å†³äº†å›  HTML ç¼©è¿›å¯¼è‡´çš„ Markdown è§£æé”™è¯¯ï¼ˆé˜²æ­¢ä»£ç å—éœ²å‡ºï¼‰ã€‚
    *   **è‡ªé€‚åº”å¸ƒå±€**: æ‰‹æœºç«¯é—´è·æ ¹æ®è§†è§‰æ¯”ä¾‹åŠ¨æ€å¾®è°ƒï¼Œç¡®ä¿å¹³è¡¡ç¾è§‚ã€‚
    *   **è·¨ç«¯éš”ç¦»**: æ¡Œé¢ä¸æ‰‹æœºç«¯é€»è¾‘ç‹¬ç«‹æ¸²æŸ“ï¼Œäº’ä¸å¹²æ‰°ã€‚

---

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```mermaid
graph TD
    User(ç”¨æˆ·/GPT) -->|è¯­éŸ³/æ–‡å­—| API(Supabase Edge Function)
    
    API -->|SQL| DB[(Supabase Database)]
    
    Streamlit(Streamlit Dashboard) -->|GET /list| API
    Streamlit -->|POST /update| API
    Streamlit -->|POST /delete| API
    
    API -->|JSON| Streamlit
```

---

## ğŸ› ï¸ API æ¥å£ (Supabase Edge Function)

æ‰€æœ‰æ“ä½œå‡éœ€é€šè¿‡ Supabase Functions è°ƒç”¨ã€‚Custom GPTæ— éœ€é‰´æƒï¼ˆå·²é…ç½® `--no-verify-jwt`ï¼‰ã€‚

### æ ¸å¿ƒè®°è´¦
| æ–¹æ³• | è·¯å¾„ | æè¿° |
|---|---|---|
| `POST` | `/add` | è‡ªç„¶è¯­è¨€è®°è´¦ (GPT è§£æ) |
| `GET` | `/list` | è·å–æœ€è¿‘è®°å½• |
| `POST` | `/update` | **[NEW]** ä¿®æ”¹è®°å½• (ID) |
| `POST` | `/delete` | **[NEW]** åˆ é™¤è®°å½• (ID) |

### é¢„ç®—ä¸å‘¨æœŸ
| æ–¹æ³• | è·¯å¾„ | æè¿° |
|---|---|---|
| `GET` | `/budget/list` | è·å–é¢„ç®—åˆ—è¡¨ |
| `POST` | `/budget/add` | æ–°å¢é¢„ç®— |
| `POST` | `/budget/delete` | åˆ é™¤é¢„ç®— |
| `GET` | `/recurring/list` | è·å–å›ºå®šè§„åˆ™åˆ—è¡¨ |
| `POST` | `/recurring/add` | æ–°å¢è§„åˆ™ |
| `POST` | `/recurring/delete` | åˆ é™¤è§„åˆ™ |

---

## ğŸ“‚ æ–‡ä»¶ç»“æ„ (File Structure)

```text
â”œâ”€â”€ .streamlit/          # Streamlit é…ç½® (secrets.toml)
â”œâ”€â”€ assets/              # é™æ€èµ„æº (Logo, Icons)
â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶ (rules.py)
â”œâ”€â”€ docs/                # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ modules/             # Python æ¨¡å— (UI, Services, Auth)
â”‚   â”œâ”€â”€ auth.py          # è®¤è¯é€»è¾‘
â”‚   â”œâ”€â”€ services.py      # æ•°æ®åº“äº¤äº’
â”‚   â””â”€â”€ ui_v2.py         # æ ¸å¿ƒ UI ç»„ä»¶ & Mobile é€‚é…
â”œâ”€â”€ scripts/             # è‡ªåŠ¨åŒ–è„šæœ¬ (Cron Jobs)
â”œâ”€â”€ supabase/            # Supabase ç›¸å…³
â”‚   â”œâ”€â”€ functions/
â”‚   â”‚   â””â”€â”€ gpt-api/     # æ ¸å¿ƒ API (Deno/Typescript)
â”‚   â””â”€â”€ config.toml      # Supabase é…ç½®
â”œâ”€â”€ app.py               # Streamlit ä¸»ç¨‹åº (Frontend)
â”œâ”€â”€ expense_chat.py      # æœ¬åœ°å¯¹è¯é€»è¾‘å¤„ç†
â”œâ”€â”€ openapi_supabase.json # Custom GPT Action Schema
â”œâ”€â”€ requirements.txt     # Python ä¾èµ–
â””â”€â”€ supabase_setup.sql   # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
```

---

## ğŸ–¥ï¸ éƒ¨ç½²æŒ‡å—

### 1. Supabase Edge Function (åç«¯ API)
è¿™æ˜¯è¿æ¥ Custom GPT å’Œæ•°æ®åº“çš„æ ¸å¿ƒæ¡¥æ¢ã€‚

**å‰ææ¡ä»¶**:
- å®‰è£… Supabase CLI / Node.js
- ç™»å½•: `npx supabase login`

**éƒ¨ç½²å‘½ä»¤**:
```bash
npx supabase functions deploy gpt-api --no-verify-jwt
```
> æ³¨æ„: `--no-verify-jwt` æ˜¯å¿…é¡»çš„ï¼Œå› ä¸º Custom GPT ä¸ä¼šå‘é€ Supabase çš„ Auth Tokenã€‚æˆ‘ä»¬é€šè¿‡ä»£ç ä¸­çš„é€»è¾‘è‡ªåŠ¨å…³è”æ´»è·ƒç”¨æˆ·ã€‚

### 2. Custom GPT é…ç½®
1. åˆ›å»ºä¸€ä¸ªæ–°çš„ GPTã€‚
2. åœ¨ **Actions** ä¸­ï¼Œå¯¼å…¥ `openapi_supabase.json` çš„å†…å®¹ã€‚
3. **Authentication**: é€‰æ‹© `None` (æ— éœ€é‰´æƒ)ã€‚
4. Enjoy! ğŸ‰

### 3. Streamlit Dashboard (å‰ç«¯ App)
æœ¬åœ°è¿è¡Œ:
```bash
pip install -r requirements.txt
streamlit run app.py
```

é…ç½®æ–‡ä»¶ `.streamlit/secrets.toml`:
```toml
[supabase]
url = "YOUR_SUPABASE_URL"
key = "YOUR_SUPABASE_ANON_KEY"
```

---

## ğŸ“ å¾…åŠè®¡åˆ’ (Roadmap)
- [x] **V3.0**: æœˆåº¦é¢„ç®—ç®¡ç† (Monthly Budgets)
- [x] **V3.0**: è‡ªåŠ¨å‘¨æœŸæ‰£æ¬¾ (Recurring Expenses)
- [x] **V3.3**: GPT æ·±åº¦é›†æˆ (å¢åˆ æ”¹æŸ¥å…¨æ”¯æŒ)
- [x] **Fix**: å¤šè®¾å¤‡/å¤šè´¦å·æ•°æ®åŒæ­¥é—®é¢˜
- [ ] å¤šè´¦æˆ·/å¤šå¸ç§æ”¯æŒ
- [ ] å¹´åº¦æ¶ˆè´¹æ·±åº¦åˆ†ææŠ¥å‘Š
